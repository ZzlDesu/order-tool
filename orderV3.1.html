<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>订单信息拆分工具</title>
    <link rel="icon" href="./favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --gray-color: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: var(--gray-color);
            font-size: 1.2rem;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: white;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: var(--light-color);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: var(--gray-color);
            min-width: 150px;
        }
        
        .tab.active {
            background: white;
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }
        
        .tab i {
            margin-right: 10px;
        }
        
        .tab:hover {
            background: white;
            color: var(--primary-color);
        }
        
        .content {
            background: white;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 20px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            resize: vertical;
            font-size: 16px;
            line-height: 1.6;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .parse-btn {
            background: var(--primary-color);
            color: white;
        }
        
        .parse-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .copy-btn {
            background: var(--success-color);
            color: white;
        }
        
        .copy-btn:hover {
            background: #3aafd9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.3);
        }
        
        .clear-btn {
            background: var(--warning-color);
            color: white;
        }
        
        .clear-btn:hover {
            background: #d61a6d;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(247, 37, 133, 0.3);
        }
        
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            margin: 30px 0;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            min-width: 1200px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
            white-space: nowrap;
        }
        
        th {
            background: var(--primary-color);
            color: white;
            position: sticky;
            top: 0;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e9ecef;
        }
        
        .stats {
            margin-top: 20px;
            font-size: 16px;
            color: var(--gray-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-badge {
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .instructions {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            margin: 30px 0;
            border-radius: 8px;
        }
        
        .instructions h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            color: var(--gray-color);
            font-size: 14px;
        }
        
        /* 商品编码查询部分 - 更新为新样式 */
        .product-section {
            padding: 25px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .search-container {
            display: flex;
            margin-bottom: 20px;
        }
        
        #product-search {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 6px 0 0 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        #product-search:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        #search-button {
            border-radius: 0 6px 6px 0;
            background: var(--primary-color);
            color: white;
            padding: 0 25px;
        }
        
        .product-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }
        
        .product-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .product-item:last-child {
            border-bottom: none;
        }
        
        .product-item:hover {
            background-color: #f9f9f9;
            cursor: pointer;
        }
        
        .product-name {
            flex: 2;
        }
        
        .product-code {
            flex: 1;
            text-align: right;
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .highlight {
            background-color: #fff8e1;
            font-weight: bold;
        }
        
        .selected-product {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
        }
        
        .selected-product h3 {
            margin-bottom: 10px;
            color: #2e7d32;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #28a745;
            color: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-100px);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            #product-search {
                border-radius: 6px;
                margin-bottom: 10px;
            }
            
            #search-button {
                border-radius: 6px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>订单信息拆分工具</h1>
            <p class="subtitle">快速解析订单信息并导出为表格格式</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="general-split">
                <i class="fas fa-table"></i>通用格式（拆分）
            </div>
            <div class="tab" data-tab="general-unsplit">
                <i class="fas fa-list"></i>通用格式（不拆分）
            </div>
            <div class="tab" data-tab="lpt">
                <i class="fas fa-list-alt"></i>LPT格式
            </div>
            <div class="tab" data-tab="hy">
                <i class="fas fa-map-marker-alt"></i>HY格式
            </div>
        </div>
        
        <div class="content">
            <!-- 通用格式（拆分） -->
            <div class="tab-content active" id="general-split">
                <h2>通用格式（拆分）解析</h2>
                <textarea id="inputDataGeneralSplit" placeholder="请粘贴快捷复制的订单信息..."></textarea>
                
                <div class="button-group">
                    <button class="parse-btn" data-format="general-split">
                        <i class="fas fa-cogs"></i>解析订单信息
                    </button>
                    <button class="clear-btn" data-clear="general-split">
                        <i class="fas fa-broom"></i>清空输入
                    </button>
                    <button class="copy-btn" data-copy="general-split">
                        <i class="fas fa-copy"></i>复制到剪贴板
                    </button>
                </div>
                
                <div class="table-container">
                    <table id="resultTableGeneralSplit">
                        <thead>
                            <tr>
                                <th>订单编号</th>
                                <th>收件人</th>
                                <th>手机号</th>
                                <th>地址</th>
                                <th>商品信息</th>
                                <th>数量</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" style="text-align: center;">请输入订单信息并点击解析</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="stats">
                    <i class="fas fa-chart-bar"></i>已解析: <span class="stats-badge" id="orderCountGeneralSplit">0</span> 个订单
                </div>
                
                <div class="instructions">
                    <h3>通用格式（拆分）说明：</h3>
                    <ul>
                        <li>此格式包含完整的订单信息，包括配送拨打信息</li>
                        <li>表格列顺序：订单编号、收件人、手机号、地址、商品信息、数量</li>
                        <li>适合需要完整信息的场景</li>
                    </ul>
                </div>
            </div>
            
            <!-- 通用格式（不拆分） -->
            <div class="tab-content" id="general-unsplit">
                <h2>通用格式（不拆分）解析</h2>
                <textarea id="inputDataGeneralUnsplit" placeholder="请粘贴快捷复制的订单信息..."></textarea>
                
                <div class="button-group">
                    <button class="parse-btn" data-format="general-unsplit">
                        <i class="fas fa-cogs"></i>解析订单信息
                    </button>
                    <button class="clear-btn" data-clear="general-unsplit">
                        <i class="fas fa-broom"></i>清空输入
                    </button>
                    <button class="copy-btn" data-copy="general-unsplit">
                        <i class="fas fa-copy"></i>复制到剪贴板
                    </button>
                </div>
                
                <div class="table-container">
                    <table id="resultTableGeneralUnsplit">
                        <thead>
                            <tr>
                                <th>订单编号</th>
                                <th>收件信息</th>
                                <th>商品信息</th>
                                <th>数量</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" style="text-align: center;">请输入订单信息并点击解析</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="stats">
                    <i class="fas fa-chart-bar"></i>已解析: <span class="stats-badge" id="orderCountGeneralUnsplit">0</span> 个订单
                </div>
            </div>
            
            <div class="tab-content" id="lpt">
                <h2>LPT格式解析</h2>
                <textarea id="inputDataLpt" placeholder="请粘贴快捷复制的订单信息..."></textarea>
                
                <div class="button-group">
                    <button class="parse-btn" data-format="lpt">
                        <i class="fas fa-cogs"></i>解析订单信息
                    </button>
                    <button class="clear-btn" data-clear="lpt">
                        <i class="fas fa-broom"></i>清空输入
                    </button>
                    <button class="copy-btn" data-copy="lpt">
                        <i class="fas fa-copy"></i>复制到剪贴板
                    </button>
                </div>
                
                <div class="table-container">
                    <table id="resultTableLpt">
                        <thead>
                            <tr>
                                <th>规格</th>
                                <th>数量</th>
                                <th>收货信息</th>
                                <th>订单编号</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" style="text-align: center;">请输入订单信息并点击解析</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="stats">
                    <i class="fas fa-chart-bar"></i>已解析: <span class="stats-badge" id="orderCountLpt">0</span> 个订单
                </div>
            </div>
            
            <div class="tab-content" id="hy">
                <h2>HY格式解析</h2>
                <textarea id="inputDataHy" placeholder="请粘贴订单信息..."></textarea>
                
                <div class="button-group">
                    <button class="parse-btn" data-format="hy">
                        <i class="fas fa-cogs"></i>解析订单信息
                    </button>
                    <button class="clear-btn" data-clear="hy">
                        <i class="fas fa-broom"></i>清空输入
                    </button>
                    <button class="copy-btn" data-copy="hy">
                        <i class="fas fa-copy"></i>复制到剪贴板
                    </button>
                </div>
                
                <div class="table-container">
                    <table id="resultTableHy">
                        <thead>
                            <tr>
                                <th>收货人</th>
                                <th>昵称（旺旺号）</th>
                                <th>手机号码</th>
                                <th>固定电话</th>
                                <th>仓库名称</th>
                                <th>省</th>
                                <th>市</th>
                                <th>区</th>
                                <th>详细地址</th>
                                <th>邮政编码</th>
                                <th>商家编码</th>
                                <th>数量</th>
                                <th>商品付款金额</th>
                                <th>运费</th>
                                <th>发票抬头</th>
                                <th>买家留言</th>
                                <th>卖家备注</th>
                                <th>平台交易号</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="18" style="text-align: center;">请输入订单信息并点击解析</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="stats">
                    <i class="fas fa-chart-bar"></i>已解析: <span class="stats-badge" id="orderCountHy">0</span> 个订单
                </div>
                
                <!-- 商品编码查询部分 - 替换为新功能 -->
                <div class="product-section">
                    <h3>商品编码查询</h3>
                    <div class="search-container">
                        <input type="text" id="product-search" placeholder="输入商品名称或编码搜索...">
                        <button id="search-button">
                            <i class="fas fa-search"></i>搜索
                        </button>
                    </div>
                    
                    <div class="selected-product">
                        <h3>已选商品</h3>
                        <div id="selected-product-info">暂无选择</div>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px;">商品列表</h3>
                    <div class="product-list" id="product-list">
                        <!-- 商品列表将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>订单信息拆分工具 © </p>
        </footer>
    </div>

    <div class="notification" id="notification">已复制到剪贴板！</div>

    <script>
        // 存储不同格式的原始解析数据
        const parsedData = {
            'general-split': [],
            'general-unsplit': [],
            'lpt': [],
            'hy': []
        };
        
        // 商品数据 - 替换为新的商品列表
        const products = [
            { name: "草莓小兔软萌屁屁贴", code: "0490-1" },
            { name: "可爱小熊软萌屁屁贴", code: "0490-2" },
            { name: "草莓小兔+可爱小熊屁屁贴", code: "Z2889" },
            { name: "3D立体百变迷宫", code: "Z2769" },
            { name: "小树毛粘板+切切乐17件套", code: "Z2774" },
            { name: "切切乐17件套", code: "Z2800" },
            { name: "小树毛毡板", code: "0473-1" },
            { name: "爱迪生电力科学宝盒", code: "Z2763" },
            { name: "DIY炒冰手作球", code: "Z2758" },
            { name: "公主变装秀", code: "Z2798" },
            { name: "五官表情秀", code: "Z2797" },
            { name: "折来折去", code: "0424-1" },
            { name: "熊有成竹", code: "0475-1" },
            { name: "DIY果冻沙食玩", code: "0423-1" },
            { name: "DIY迷你手作食玩", code: "Z1698" },
            { name: "动物园园长", code: "0464-1" },
            { name: "水精灵嗨得捞", code: "Z2783" },
            { name: "闪闪沙画集", code: "Z2573" },
            { name: "警察抓小偷", code: "Z2212" },
            { name: "苹果毛毡板+切切乐17件套", code: "Z2777" },
            { name: "星星人洞洞乐", code: "0500-1" }
        ];
        
        // 当前选中的商品
        let selectedProduct = null;
        
        // 辅助函数：将带连字符的字符串转换为驼峰式命名
        function kebabToCamelCase(str) {
            return str.replace(/-([a-z])/g, function(g) {
                return g[1].toUpperCase();
            });
        }
        
        // 辅助函数：添加配送信息，避免重复，保留"转"字
        function addDeliveryInfo(baseStr, phone) {
            // 检查是否已包含配送信息
            if (baseStr.includes('【配送拨打:')) {
                return baseStr;
            }
            // 保留原始电话号码中的"转"字，不进行替换
            return `${baseStr}【配送拨打:${phone}】`;
        }
        
        // 初始化商品列表
        function initProductList() {
            renderProductList(products);
        }
        
        // 渲染商品列表
        function renderProductList(productsToRender, searchTerm = '') {
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';
            
            if (productsToRender.length === 0) {
                productList.innerHTML = '<div style="text-align: center; padding: 20px;">未找到匹配的商品</div>';
                return;
            }
            
            productsToRender.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'product-item';
                
                // 高亮搜索匹配的文本
                let displayName = product.name;
                let displayCode = product.code;
                
                if (searchTerm) {
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    displayName = product.name.replace(regex, '<span class="highlight">$1</span>');
                    displayCode = product.code.replace(regex, '<span class="highlight">$1</span>');
                }
                
                productItem.innerHTML = `
                    <div class="product-name">${displayName}</div>
                    <div class="product-code">${displayCode}</div>
                `;
                
                productItem.addEventListener('click', () => {
                    selectProduct(product);
                });
                
                productList.appendChild(productItem);
            });
        }
        
        // 搜索商品
        function searchProducts() {
            const searchTerm = document.getElementById('product-search').value.trim().toLowerCase();
            
            if (!searchTerm) {
                renderProductList(products);
                return;
            }
            
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm) || 
                product.code.toLowerCase().includes(searchTerm)
            );
            
            renderProductList(filteredProducts, searchTerm);
        }
        
        // 选择商品
        function selectProduct(product) {
            selectedProduct = product;
            
            const selectedProductInfo = document.getElementById('selected-product-info');
            
            selectedProductInfo.innerHTML = `
                <strong>${product.name}</strong> - <span style="color: var(--primary-color);">${product.code}</span>
                <button class="copy-btn" style="margin-left: 10px; padding: 5px 10px; font-size: 12px;" 
                        data-product-code="${product.code}">复制编码</button>
            `;
            
            // 添加复制编码按钮的事件
            const copyBtn = selectedProductInfo.querySelector('.copy-btn');
            copyBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                copyToClipboard(product.code);
                showNotification(`已复制商品编码: ${product.code}`);
            });
            
            // 如果有解析的订单，更新商家编码
            if (parsedData['hy'].length > 0) {
                // 更新最后一个订单的商家编码
                parsedData['hy'][parsedData['hy'].length - 1].merchantCode = product.code;
                displayOrdersHy(parsedData['hy']);
                showNotification(`已为最新订单设置商品编码: ${product.code}`);
            } else {
                showNotification(`已选择商品: ${product.name}`);
            }
        }
        
        // 选项卡切换功能
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                // 切换到HY格式时初始化商品列表
                if (tabId === 'hy') {
                    initProductList();
                }
            });
        });
        
        // 商品搜索事件监听
        document.getElementById('search-button').addEventListener('click', searchProducts);
        document.getElementById('product-search').addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });
        
        // 解析按钮事件
        document.querySelectorAll('.parse-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const format = this.getAttribute('data-format');
                const camelCaseFormat = kebabToCamelCase(format);
                const inputData = document.getElementById(`inputData${camelCaseFormat.charAt(0).toUpperCase() + camelCaseFormat.slice(1)}`).value;
                
                if (!inputData.trim()) {
                    alert('请输入信息');
                    return;
                }
                
                let orders;
                if (format === 'general-split') {
                    orders = parseOrdersGeneralSplit(inputData);
                    parsedData[format] = orders; // 存储原始解析数据
                    displayOrdersGeneralSplit(orders);
                } else if (format === 'general-unsplit') {
                    orders = parseOrdersGeneralUnsplit(inputData);
                    parsedData[format] = orders;
                    displayOrdersGeneralUnsplit(orders);
                } else if (format === 'lpt') {
                    orders = parseOrdersLpt(inputData);
                    parsedData[format] = orders;
                    displayOrdersLpt(orders);
                } else if (format === 'hy') {
                    orders = parseOrdersHy(inputData);
                    parsedData[format] = orders;
                    displayOrdersHy(orders);
                    
                    // 如果有选中的商品，更新第一个订单的商家编码
                    if (selectedProduct) {
                        parsedData[format][0].merchantCode = selectedProduct.code;
                        displayOrdersHy(parsedData[format]);
                    }
                }
            });
        });
        
        // 清空按钮事件
        document.querySelectorAll('.clear-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const format = this.getAttribute('data-clear');
                const camelCaseFormat = kebabToCamelCase(format);
                document.getElementById(`inputData${camelCaseFormat.charAt(0).toUpperCase() + camelCaseFormat.slice(1)}`).value = '';
                
                // 清空存储的解析数据
                parsedData[format] = [];
                
                if (format === 'general-split') {
                    document.querySelector('#resultTableGeneralSplit tbody').innerHTML = 
                        '<tr><td colspan="6" style="text-align: center;">请输入订单信息并点击解析</td></tr>';
                    document.getElementById('orderCountGeneralSplit').textContent = '0';
                } else if (format === 'general-unsplit') {
                    document.querySelector('#resultTableGeneralUnsplit tbody').innerHTML = 
                        '<tr><td colspan="4" style="text-align: center;">请输入订单信息并点击解析</td></tr>';
                    document.getElementById('orderCountGeneralUnsplit').textContent = '0';
                } else if (format === 'lpt') {
                    document.querySelector('#resultTableLpt tbody').innerHTML = 
                        '<tr><td colspan="4" style="text-align: center;">请输入订单信息并点击解析</td></tr>';
                    document.getElementById('orderCountLpt').textContent = '0';
                } else if (format === 'hy') {
                    document.querySelector('#resultTableHy tbody').innerHTML = 
                        '<tr><td colspan="18" style="text-align: center;">请输入订单信息并点击解析</td></tr>';
                    document.getElementById('orderCountHy').textContent = '0';
                    // 重置选中的商品
                    selectedProduct = null;
                    document.getElementById('selected-product-info').textContent = '暂无选择';
                }
            });
        });
        
        // 复制按钮事件 - 使用原始解析数据生成复制文本
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const format = this.getAttribute('data-copy');
                if (!format || parsedData[format].length === 0) {
                    showNotification('没有可复制的数据');
                    return;
                }
                
                let tabText = '';
                
                // 根据不同格式，直接从原始数据生成制表符分隔的文本
                if (format === 'general-split') {
                    tabText = parsedData[format].map(order => 
                        `${order.orderId}\t${order.receiver}\t${order.phone}\t${order.address}\t${order.product}\t${order.quantity}`
                    ).join('\n');
                } else if (format === 'general-unsplit') {
                    tabText = parsedData[format].map(order => 
                        `${order.orderId}\t${order.receiverInfo}\t${order.product}\t${order.quantity}`
                    ).join('\n');
                } else if (format === 'lpt') {
                    tabText = parsedData[format].map(order => 
                        `${order.product}\t${order.quantity}\t${order.receiverInfo}\t${order.orderId}`
                    ).join('\n');
                } else if (format === 'hy') {
                    tabText = parsedData[format].map(order => 
                        `${order.receiver}\t${order.nickname}\t${order.phone}\t${order.fixedPhone}\t${order.warehouse}\t${order.province}\t${order.city}\t${order.district}\t${order.detailAddress}\t${order.zipCode}\t${order.merchantCode}\t${order.quantity}\t${order.paymentAmount}\t${order.freight}\t${order.invoiceTitle}\t${order.buyerMessage}\t${order.sellerRemark}\t${order.platformTradeNo}`
                    ).join('\n');
                }
                
                copyToClipboard(tabText);
                
                // 显示复制成功提示
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-check"></i>已复制!';
                this.style.background = '#2ecc71';
                
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.style.background = '';
                }, 2000);
            });
        });
        
        // 通用格式（拆分）解析函数
        function parseOrdersGeneralSplit(input) {
            const orderBlocks = input.split(/(?=订单编号：)/).filter(block => block.trim());
            const orders = [];
            
            for (const block of orderBlocks) {
                try {
                    // 提取订单编号
                    const orderIdMatch = block.match(/订单编号：\s*(\d+)/);
                    if (!orderIdMatch) continue;
                    
                    const orderId = orderIdMatch[1];
                    
                    // 提取收货信息
                    const receiverInfoMatch = block.match(/收货信息：\s*([^,]+),([^,]+),([^\n]+)/);
                    if (!receiverInfoMatch) continue;
                    
                    const receiver = receiverInfoMatch[1];
                    const phone = receiverInfoMatch[2];
                    // 使用辅助函数添加配送信息，避免重复
                    const address = addDeliveryInfo(receiverInfoMatch[3].trim(), phone);
                    
                    // 提取所有商品信息和数量
                    const productMatches = block.match(/(颜色分类|款式描述):([^，,]+)[，,]\s*数量：(\d+)件/g);
                    
                    if (productMatches && productMatches.length > 0) {
                        productMatches.forEach((match, index) => {
                            const productDetail = match.match(/(颜色分类|款式描述):([^，,]+)[，,]\s*数量：(\d+)件/);
                            if (productDetail) {
                                const product = productDetail[2].trim();
                                const quantity = productDetail[3];
                                
                                orders.push({
                                    orderId,
                                    receiver,
                                    phone,
                                    address,
                                    product,
                                    quantity,
                                    isFirstInGroup: index === 0,
                                    groupSize: productMatches.length
                                });
                            }
                        });
                    } else {
                        orders.push({
                            orderId,
                            receiver,
                            phone,
                            address,
                            product: '',
                            quantity: '',
                            isFirstInGroup: true,
                            groupSize: 1
                        });
                    }
                } catch (e) {
                    console.error('解析订单时出错:', e);
                }
            }
            
            return orders;
        }
        
        // 通用格式（拆分）显示函数
        function displayOrdersGeneralSplit(orders) {
            const tbody = document.querySelector('#resultTableGeneralSplit tbody');
            tbody.innerHTML = '';
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">未解析到订单数据</td></tr>';
                document.getElementById('orderCountGeneralSplit').textContent = '0';
                return;
            }
            
            // 计算唯一订单数量
            const uniqueOrderIds = new Set(orders.map(order => order.orderId));
            document.getElementById('orderCountGeneralSplit').textContent = uniqueOrderIds.size;
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.orderId || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.receiver || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.phone || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.address || ''}</td>
                    <td>${order.product || ''}</td>
                    <td>${order.quantity || ''}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // 通用格式（不拆分）解析函数
        function parseOrdersGeneralUnsplit(input) {
            const orderBlocks = input.split(/(?=订单编号：)/).filter(block => block.trim());
            const orders = [];
            
            for (const block of orderBlocks) {
                try {
                    const orderIdMatch = block.match(/订单编号：\s*(\d+)/);
                    if (!orderIdMatch) continue;
                    
                    const orderId = orderIdMatch[1];
                    
                    const receiverInfoMatch = block.match(/收货信息：\s*([^\n]+)/);
                    if (!receiverInfoMatch) continue;
                    
                    let fullReceiverInfo = receiverInfoMatch[1].trim();
                    const phoneMatch = fullReceiverInfo.match(/([^,]+),([^,]+),(.*)/);
                    
                    let receiverInfo = fullReceiverInfo;
                    if (phoneMatch) {
                        const phone = phoneMatch[2];
                        // 使用辅助函数添加配送信息，避免重复
                        receiverInfo = `${phoneMatch[1]},${phone},${addDeliveryInfo(phoneMatch[3], phone)}`;
                    }
                    
                    const productMatches = block.match(/(颜色分类|款式描述):([^，,]+)[，,]\s*数量：(\d+)件/g);
                    
                    if (productMatches && productMatches.length > 0) {
                        productMatches.forEach((match, index) => {
                            const productDetail = match.match(/(颜色分类|款式描述):([^，,]+)[，,]\s*数量：(\d+)件/);
                            if (productDetail) {
                                const product = productDetail[2].trim();
                                const quantity = productDetail[3];
                                
                                orders.push({
                                    orderId,
                                    receiverInfo,
                                    product,
                                    quantity,
                                    isFirstInGroup: index === 0,
                                    groupSize: productMatches.length
                                });
                            }
                        });
                    } else {
                        orders.push({
                            orderId,
                            receiverInfo,
                            product: '',
                            quantity: '',
                            isFirstInGroup: true,
                            groupSize: 1
                        });
                    }
                } catch (e) {
                    console.error('解析订单时出错:', e);
                }
            }
            
            return orders;
        }
        
        // 通用格式（不拆分）显示函数
        function displayOrdersGeneralUnsplit(orders) {
            const tbody = document.querySelector('#resultTableGeneralUnsplit tbody');
            tbody.innerHTML = '';
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">未解析到订单数据</td></tr>';
                document.getElementById('orderCountGeneralUnsplit').textContent = '0';
                return;
            }
            
            const uniqueOrderIds = new Set(orders.map(order => order.orderId));
            document.getElementById('orderCountGeneralUnsplit').textContent = uniqueOrderIds.size;
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.orderId || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.receiverInfo || ''}</td>
                    <td>${order.product || ''}</td>
                    <td>${order.quantity || ''}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // LPT格式解析和显示函数
        function parseOrdersLpt(input) {
            const orderBlocks = input.split(/(?=订单编号：)/).filter(block => block.trim());
            const orders = [];
            
            for (const block of orderBlocks) {
                try {
                    const orderIdMatch = block.match(/订单编号：\s*(\d+)/);
                    if (!orderIdMatch) continue;
                    
                    const orderId = orderIdMatch[1];
                    const receiverInfoMatch = block.match(/收货信息：([^\n]+)/);
                    if (!receiverInfoMatch) continue;
                    
                    let receiverInfo = receiverInfoMatch[1].trim();
                    const phoneMatch = receiverInfo.match(/([^,]+),([^,]+),(.*)/);
                    
                    if (phoneMatch) {
                        const phone = phoneMatch[2];
                        // 使用辅助函数添加配送信息，避免重复
                        receiverInfo = `${phoneMatch[1]},${phone},${addDeliveryInfo(phoneMatch[3], phone)}`;
                    }
                    
                    const productMatches = block.match(/(颜色分类|款式描述):([^，,]+)[，,]\s*数量：(\d+)件/g);
                    
                    if (productMatches && productMatches.length > 0) {
                        productMatches.forEach((match, index) => {
                            const productDetail = match.match(/(颜色分类|款式描述):([^，,]+)[，,]\s*数量：(\d+)件/);
                            if (productDetail) {
                                const product = productDetail[2].trim();
                                const quantity = productDetail[3];
                                
                                orders.push({
                                    product,
                                    quantity,
                                    receiverInfo,
                                    orderId,
                                    isFirstInGroup: index === 0,
                                    groupSize: productMatches.length
                                });
                            }
                        });
                    } else {
                        orders.push({
                            product: '',
                            quantity: '',
                            receiverInfo,
                            orderId,
                            isFirstInGroup: true,
                            groupSize: 1
                        });
                    }
                } catch (e) {
                    console.error('解析订单时出错:', e);
                }
            }
            
            return orders;
        }
        
        function displayOrdersLpt(orders) {
            const tbody = document.querySelector('#resultTableLpt tbody');
            tbody.innerHTML = '';
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">未解析到订单数据</td></tr>';
                document.getElementById('orderCountLpt').textContent = '0';
                return;
            }
            
            const uniqueOrderIds = new Set(orders.map(order => order.orderId));
            document.getElementById('orderCountLpt').textContent = uniqueOrderIds.size;
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${order.product || ''}</td>
                    <td>${order.quantity || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.receiverInfo || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.orderId || ''}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // HY格式解析和显示函数
        function parseOrdersHy(input) {
            const orderBlocks = input.split(/(?=订单编号：)/).filter(block => block.trim());
            const orders = [];
            
            for (const block of orderBlocks) {
                try {
                    const orderIdMatch = block.match(/订单编号：\s*(\d+)/);
                    if (!orderIdMatch) continue;
                    
                    const orderId = orderIdMatch[1];
                    const receiverInfoMatch = block.match(/收货信息：\s*([^,]+),([^,]+),([^\n]+)/);
                    if (!receiverInfoMatch) continue;
                    
                    const receiver = receiverInfoMatch[1];
                    const phone = receiverInfoMatch[2];
                    const fullAddress = receiverInfoMatch[3].trim();
                    
                    const baseOrder = {
                        receiver: receiver,
                        nickname: '',
                        phone: phone,
                        fixedPhone: '',
                        warehouse: '默认仓库',
                        province: '',
                        city: '',
                        district: '',
                        detailAddress: '',
                        zipCode: '',
                        merchantCode: '', // 商家编码字段
                        quantity: '',
                        paymentAmount: '',
                        freight: '',
                        invoiceTitle: '',
                        buyerMessage: '',
                        sellerRemark: '',
                        platformTradeNo: orderId
                    };
                    
                    const addressParts = fullAddress.split(/\s+/);
                    
                    if (addressParts.length >= 3) {
                        baseOrder.province = addressParts[0];
                        baseOrder.city = addressParts[1];
                        
                        if (addressParts[2].match(/[区县市镇]/)) {
                            baseOrder.district = addressParts[2];
                            baseOrder.detailAddress = addressParts.slice(3).join(' ');
                        } else {
                            baseOrder.district = '';
                            baseOrder.detailAddress = addressParts.slice(2).join(' ');
                        }
                    } else if (addressParts.length === 2) {
                        baseOrder.province = addressParts[0];
                        baseOrder.city = addressParts[1];
                    } else if (addressParts.length === 1) {
                        baseOrder.detailAddress = addressParts[0];
                    }
                    
                    // 使用辅助函数添加配送信息，避免重复
                    baseOrder.detailAddress = addDeliveryInfo(baseOrder.detailAddress, phone);
                    
                    const productMatches = block.match(/(颜色分类|款式描述):([^，,]+)[，,]\s*数量：(\d+)件/g);
                    
                    if (productMatches && productMatches.length > 0) {
                        productMatches.forEach((match, index) => {
                            const productDetail = match.match(/(颜色分类|款式描述):([^，,]+)[，,]\s*数量：(\d+)件/);
                            if (productDetail) {
                                const order = {...baseOrder};
                                order.quantity = productDetail[3];
                                order.product = productDetail[2].trim();
                                order.isFirstInGroup = index === 0;
                                order.groupSize = productMatches.length;
                                
                                orders.push(order);
                            }
                        });
                    } else {
                        const order = {...baseOrder};
                        order.isFirstInGroup = true;
                        order.groupSize = 1;
                        orders.push(order);
                    }
                } catch (e) {
                    console.error('解析HY格式订单时出错:', e);
                }
            }
            
            return orders;
        }
        
        function displayOrdersHy(orders) {
            const tbody = document.querySelector('#resultTableHy tbody');
            tbody.innerHTML = '';
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="18" style="text-align: center;">未解析到订单数据</td></tr>';
                document.getElementById('orderCountHy').textContent = '0';
                return;
            }
            
            const uniqueOrderIds = new Set(orders.map(order => order.platformTradeNo));
            document.getElementById('orderCountHy').textContent = uniqueOrderIds.size;
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.receiver || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.nickname || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.phone || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.fixedPhone || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.warehouse || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.province || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.city || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.district || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.detailAddress || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.zipCode || ''}</td>
                    <td>${order.merchantCode || ''}</td>
                    <td>${order.quantity || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.paymentAmount || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.freight || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.invoiceTitle || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.buyerMessage || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.sellerRemark || ''}</td>
                    <td ${order.isFirstInGroup ? `rowspan="${order.groupSize}"` : 'style="display: none;"'}>${order.platformTradeNo || ''}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // 通用函数：复制到剪贴板
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            showNotification('已复制到剪贴板！');
        }
        
        // 显示通知
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 如果默认显示HY格式，则初始化商品列表
            if (document.getElementById('hy').classList.contains('active')) {
                initProductList();
            }
        });
    </script>
</body></html>

